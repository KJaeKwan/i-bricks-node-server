openapi: 3.0.0
info:
  title: ES Proxy API
  version: 1.0.0
  description: Elasticsearch 조회를 프록시하는 간단한 API 서버
servers:
  - url: /api/v1

paths:
  /search:
    get:
      summary: Elasticsearch search 결과 반환 API
      description: index와 q를 받아 Elasticsearch 조회 결과를 그대로 반환합니다.
      parameters:
        - in: query
          name: index
          required: true
          schema:
            type: string
          example: scholarship
        - in: query
          name: q
          required: false
          schema:
            type: string
          example: "STDNO:202010766"
        - in: query
          name: from
          required: false
          schema:
            type: integer
            default: 0
        - in: query
          name: size
          required: false
          schema:
            type: integer
            default: 10
            maximum: 100
      responses:
        "200":
          description: ES 응답 원문

  /indices/scholarship:
    get:
      summary: scholarship 인덱스 문서 조회
      description: scholarship 인덱스에서 match_all로 조회한 결과를 그대로 반환합니다.
      parameters:
        - in: query
          name: size
          required: false
          schema:
            type: integer
            default: 1000
            minimum: 1
            maximum: 10000
          description: 가져올 문서 개수 (최대 10000)
      responses:
        "200":
          description: Elasticsearch search 응답 원문

  /indices/scholarship/query:
    get:
      summary: scholarship 인덱스 문서 조회 - 파라미터 추가
      description: scholarship 인덱스에서 match_all 또는 term 필터(stdno/year/smt/inpart)를 적용해 조회한 결과를 반환합니다.
      parameters:
        - in: query
          name: size
          required: false
          schema:
            type: integer
            default: 1000
            minimum: 1
            maximum: 10000
          description: 가져올 문서 개수 (최대 10000)

        - in: query
          name: stdno
          required: false
          schema:
            type: string
          description: 학번(STDNO) exact match
          example: "202010766"

        - in: query
          name: year
          required: false
          schema:
            type: integer
          description: 학년도(SCH_YEAR) exact match
          example: 2024

        - in: query
          name: smt
          required: false
          schema:
            type: string
          description: 학기코드(SMT_RCD) exact match
          example: "1"

        - in: query
          name: inpart
          required: false
          schema:
            type: string
          description: 소득분위(INPART) exact match
          example: "8"

      responses:
        "200":
          description: Elasticsearch search 응답 원문

  /indices/scholarship/custom-response:
    get:
      summary: scholarship 인덱스 문서 조회 - 응답 가공
      description: scholarship 인덱스에서 match_all 또는 term 필터(stdno/year/smt/inpart)를 적용해 조회한 결과를 반환합니다.
      parameters:
        - in: query
          name: size
          required: false
          schema:
            type: integer
            default: 1000
            minimum: 1
            maximum: 10000
          description: 가져올 문서 개수 (최대 10000)

        - in: query
          name: stdno
          required: false
          schema:
            type: string
          description: 학번(STDNO) exact match
          example: "202010766"

        - in: query
          name: year
          required: false
          schema:
            type: integer
          description: 학년도(SCH_YEAR) exact match
          example: 2024

        - in: query
          name: smt
          required: false
          schema:
            type: string
          description: 학기코드(SMT_RCD) exact match
          example: "1"

        - in: query
          name: inpart
          required: false
          schema:
            type: string
          description: 소득분위(INPART) exact match
          example: "8"

        - in: query
          name: sourceOnly
          required: false
          schema:
            type: boolean
            default: true
          description: true면 items에 _source만 반환

        - in: query
          name: includeRaw
          required: false
          schema:
            type: boolean
            default: false
          description: true면 raw(ES 원문 응답)도 포함

      responses:
        "200":
          description: Elasticsearch search 응답 원문

  /indices/scholarship/stats:
    get:
      summary: scholarship 인덱스 통계(aggregation)
      description: stdno/year 필터 조건을 적용한 뒤 연도/나라/장학금이름 terms aggregation 결과를 반환합니다.
      parameters:
        - in: query
          name: stdno
          required: false
          schema: { type: string }
        - in: query
          name: year
          required: false
          schema: { type: integer }
        - in: query
          name: topN
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 50
          description: 각 aggregation bucket 최대 개수
      responses:
        "200":
          description: aggregation buckets

  /indices/scholarship/stats/{stdno}:
    get:
      summary: scholarship 인덱스 통계(aggregation) - 학번별
      description: 학번(stdno)을 path로 받아 필터 적용 후 연도/나라/장학금이름 terms aggregation 결과를 반환합니다.
      parameters:
        - in: path
          name: stdno
          required: true
          schema:
            type: string
          description: 학번
          example: "202010766"
      responses:
        "200":
          description: aggregation buckets
